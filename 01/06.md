| âœï¸ Tangxt | â³ 2020-07-17 | ğŸ·ï¸ directivesã€mixinã€extendsã€provide/inject |

# 06-è¿›é˜¶æ„é€ å±æ€§

## â˜…Directiveï¼ˆæŒ‡ä»¤ï¼‰

### <mark>1ï¼‰Demo1</mark>

``` html
<div id="app">
  <input v-focus>
  <button v-t-click>btn</button>
</div>
```

``` js
// Register a global custom directive called `v-focus`
Vue.directive('focus', {
  // When the bound element is inserted into the DOM...
  inserted: function(el) {
    // Focus the element
    console.dir(el)
    el.focus()
  }
})
Vue.directive('t-click', {
  inserted: function(el) {
    console.dir(el)
    el.onclick = () => {
      alert('t-click')
    }
  }
})
let vm = new Vue({
  el: '#app'
})
```

æ•ˆæœï¼š

![Demo1](assets/img/2020-07-18-10-54-56.png)

> æˆ‘ä¸å…³æ³¨å®ƒçš„å†™æ³•ï¼Œåªå…³æ³¨å®ƒçš„æ•ˆæœï¼Œä»¥åŠå®ƒç»™æˆ‘çš„æ„Ÿå—ï¼

### <mark>2ï¼‰Demo2</mark>

``` html
<div id="hook-arguments-example" v-demo:foo.a.b="message"></div>
```

``` js
Vue.directive('demo', {
  bind: function(el, binding, vnode) {
    var s = JSON.stringify
    el.innerHTML =
      'name: ' + s(binding.name) + '<br>' +
      'value: ' + s(binding.value) + '<br>' +
      'expression: ' + s(binding.expression) + '<br>' +
      'argument: ' + s(binding.arg) + '<br>' +
      'modifiers: ' + s(binding.modifiers) + '<br>' +
      'vnode keys: ' + Object.keys(vnode).join(', ')
  }
})

let vm = new Vue({
  el: '#hook-arguments-example',
  data: {
    message: 'hello!'
  }
})
```

æ•ˆæœï¼š

![Demo2](assets/img/2020-07-18-12-00-13.png)

æˆ‘ä»¬èƒ½æ‹¿åˆ°çš„æ•°æ®ï¼š

![æŒ‡ä»¤ä¸Šçš„æ•°æ®](assets/img/2020-07-18-13-23-13.png)

---

<mark>Qï¼šå…³äº `JSON.stringify` ï¼Ÿ</mark>

![JSON.stringify](assets/img/2020-07-18-12-03-17.png)

<mark>Qï¼š `bind` æ˜¯ä»€ä¹ˆï¼ŸDemo1 é‡Œè¾¹çš„ `inserted` åˆæ˜¯ä»€ä¹ˆï¼Ÿè¿˜æœ‰æˆ‘çœ‹åˆ° `model` æœ‰ `componentUpdated` ï¼Œ `show` æœ‰ `updata` å’Œ `ubind` ï¼Ÿ</mark>

å®ƒä»¬éƒ½æ˜¯ Hook Functionsï¼ˆé’©å­å‡½æ•°ï¼‰

è¿™äº›å‡½æ•°ä¼šåœ¨ç‰¹å®šçš„æ—¶æœºè¢«è°ƒç”¨ï¼

å¦‚ï¼š

1. `bind` ï¼šåªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ æ—¶è°ƒç”¨ã€‚åœ¨è¿™é‡Œå¯ä»¥è¿›è¡Œä¸€æ¬¡æ€§çš„åˆå§‹åŒ–è®¾ç½®
2. `inserted` ï¼šè¢«ç»‘å®šå…ƒç´ æ’å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨ ï¼ˆä»…ä¿è¯çˆ¶èŠ‚ç‚¹å­˜åœ¨ï¼Œä½†ä¸ä¸€å®šå·²è¢«æ’å…¥æ–‡æ¡£ä¸­ï¼‰
3. â€¦â€¦

<mark>Qï¼šä¼ ç»™é‚£äº›é’©å­å‡½æ•°æœ‰å“ªäº›å‚æ•°å‘¢ï¼Ÿ</mark>

1. `el`
2. `binding` -> ä¸€ä¸ªæŒ‡ä»¤å¦‚ `v-my-directive.foo.bar="1 + 1"` ï¼Œè¿™é‡Œè¾¹çš„æ•°æ®éƒ½èƒ½é€šè¿‡ `binding.xxx` æ‹¿åˆ°ï¼
3. `vnode`
4. `oldVnode`

### <mark>3ï¼‰Demo3</mark>

> ä¸ºä»€ä¹ˆéœ€è¦åŠ¨æ€å‚æ•°

``` html
<p v-pin="200">Stick me 200px from the top of the page</p>
```

``` js
Vue.directive('pin', {
  bind: function(el, binding, vnode) {
    el.style.position = 'fixed'
    el.style.top = binding.value + 'px'
  }
})
```

æŠŠè¿™ä¸ªç»‘å®šäº† `v-pin` æŒ‡ä»¤çš„ `p` å…ƒç´ å›ºå®šåœ¨è·ç¦»é¡µé¢**é¡¶éƒ¨** `200` åƒç´ çš„ä½ç½®

è¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è·ç¦»é¡µé¢é¡µé¢**å³è¾¹**çš„å‘¢ï¼Ÿ

éš¾é“æˆ‘åˆå¾—æä¸ª `v-right` çš„æŒ‡ä»¤å‡ºæ¥ï¼Ÿ -> æ˜¾ç„¶ï¼Œä¸éœ€è¦ï¼Œå¯ä»¥ä½¿ç”¨åŠ¨æ€å‚æ•°å‘€ï¼

åšæ³•ï¼š

``` html
<p v-pin:[direction]="200">I am pinned onto the page at 200px to the left.</p>
```

``` js
Vue.directive('pin', {
  bind: function(el, binding, vnode) {
    el.style.position = 'fixed'
    var s = (binding.arg == 'left' ? 'left' : 'top')
    el.style[s] = binding.value + 'px'
  }
})
new Vue({
  el: '#dynamicexample',
  data: function() {
    return {
      direction: 'left'
    }
  }
})
```

æ•ˆæœï¼š

![Demo3](assets/img/2020-07-18-12-39-06.png)

### <mark>4ï¼‰Demo4</mark>

![Demo4](assets/img/2020-07-18-12-58-32.png)

è¿™æ˜¯å‡½æ•°ç®€å†™ï¼Œä¸ºå•¥å«ã€Œå‡½æ•°ç®€å†™ã€ï¼Œä¸å«ã€Œå‡½æ•°å‚æ•°ã€å‘¢ï¼Ÿ

å› ä¸ºå¦‚æœä½ åœ¨ `bind` å’Œ `update` æ—¶éƒ½è§¦å‘ç›¸åŒè¡Œä¸ºï¼Œè€Œä¸å…³å¿ƒå…¶å®ƒçš„é’©å­ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥ç”¨æ‰€è°“çš„ã€Œå‡½æ•°ç®€å†™ã€å•¦ï¼è€Œä¸æ˜¯å®šä¹‰ä¸€ä¸ª `{}` ï¼Œç„¶åæ•´ä¸Šä¸¤ä¸ªé’©å­ï¼

### <mark>5ï¼‰Demo5</mark>

![Demo6](assets/img/2020-07-18-13-05-23.png)

Tipsï¼š

1. æŒ‡ä»¤éœ€è¦å¤šä¸ªå€¼ -> ä¼ å…¥ä¸€ä¸ª JavaScript å¯¹è±¡å­—é¢é‡
2. æŒ‡ä»¤å‡½æ•°èƒ½å¤Ÿæ¥å—æ‰€æœ‰**åˆæ³•çš„** JavaScript è¡¨è¾¾å¼ã€‚

### <mark>6ï¼‰ç–‘é—®</mark>

#### <mark>1ã€ä½•æ—¶ç”¨å“ªäº›é’©å­å‡½æ•°ï¼Œæˆ‘å¹¶å’©æœ‰çœ‹æ˜ç™½â€¦â€¦</mark>

1. bind: åªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ æ—¶è°ƒç”¨ã€‚
2. inserted: è¢«ç»‘å®šå…ƒç´ æ’å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨ã€‚ -> å¦‚ä¸ºå…ƒç´ ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
3. update: è¢«ç»‘å®šå…ƒç´ æ‰€åœ¨çš„æ¨¡æ¿æ›´æ–°æ—¶è°ƒç”¨ã€‚
4. componentUpdated: è¢«ç»‘å®šå…ƒç´ æ‰€åœ¨æ¨¡æ¿å®Œæˆä¸€æ¬¡æ›´æ–°å‘¨æœŸæ—¶è°ƒç”¨ã€‚
5. unbind: åªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ä¸å…ƒç´ è§£ç»‘æ—¶è°ƒç”¨ã€‚ -> å¦‚ç§»é™¤å…ƒç´ çš„äº‹ä»¶ç›‘å¬å™¨

ç¤ºä¾‹ï¼š

``` js
// è‡ªå®šä¹‰v-on2æŒ‡ä»¤
new Vue({
  el: "#app",
  directives: {
    on2: {
      // binding æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«æŒ‡ä»¤çš„å¾ˆå¤šä¿¡æ¯
      inserted(el, binding) {
        console.log('hi')
        el.addEventListener(binding.arg, binding.value)
      },
      unbind(el, binding) {
        el.removeEventListener(binding.arg, binding.value)
      }
    }
  },
  template: `
            <button v-on2:click="hi">ç‚¹æˆ‘</button>
        `,
  methods: {
    hi() {
      console.log("m");
    }
  }
})
```

> æ³¨æ„ï¼šå¦‚æœä½ è¿™æ ·å†™`<button v-on2:click="hi()">ç‚¹æˆ‘</button>`ï¼Œä¸ç”¨ç‚¹å‡»å°±ä¼šï¼Œå…ˆ `log m`ï¼Œå†`log 'hi'` -> åŸç”Ÿçš„`@click`æŒ‡ä»¤ï¼Œæ˜¾ç„¶åšäº†`hi()`è¿™ç§å€¼çš„å¤„ç†ï¼å³ä¸ä¼šæ‰§è¡Œ`hi`æ–¹æ³•ï¼Œåªæœ‰ç‚¹å‡»äº†æ‰ä¼šæ‰§è¡Œï¼

#### <mark>2ã€é’©å­å‡½æ•°çš„ä¸‰ä¸ªå‚æ•°ï¼Ÿ</mark>

1. `el` æŒ‡ä»¤æ‰€ç»‘å®šçš„å…ƒç´ ï¼Œå¯ä»¥ç”¨æ¥ç›´æ¥æ“ä½œDOM
2. `binding` ï¼šä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«æŒ‡ä»¤çš„**å¾ˆå¤šä¿¡æ¯**
3. `vnode` ï¼šVueç¼–è¯‘ç”Ÿæˆçš„è™šæ‹ŸèŠ‚ç‚¹

### <mark>7ï¼‰å°ç»“</mark>

1. è‡ªå®šä¹‰æŒ‡ä»¤çš„ä¸¤ç§å†™æ³•
   1. å£°æ˜ä¸€ä¸ªå…¨å±€æŒ‡ä»¤ï¼š`Vue.directive('x',directiveOptions)` -> å¯ä»¥åœ¨ä»»ä½•ç»„ä»¶é‡Œç”¨ `v-x`
   2. å£°æ˜ä¸€ä¸ªå±€éƒ¨æŒ‡ä»¤ -> `new Vue({...,directives: {"x": directiveOptions}})` -> `v-x` åªèƒ½ç”¨åœ¨è¯¥å®ä¾‹ä¸­
2. `directiveOptions` -> æœ‰5ä¸ªå‡½æ•°å±æ€§
   1. `bind(el,info,vnode,oldVnode)`-ç±»ä¼¼ `created`
   2. `inserted(å‚æ•°åŒä¸Š)`-ç±»ä¼¼`mounted`
   3. `update(å‚æ•°åŒä¸Š)`-ç±»ä¼¼`updated`
   4. `componentUpdated(å‚æ•°åŒä¸Š)`-ç”¨å¾—ä¸å¤š
   5. `unbind(å‚æ•°åŒä¸Š)`-ç±»ä¼¼`destroyed`
3. æŒ‡ä»¤çš„ä½œç”¨
   1. ä¸»è¦ç”¨äº DOM æ“ä½œ
      1. Vueçš„å®ä¾‹/ç»„ä»¶ç”¨äºæ•°æ®ç»‘å®šã€äº‹ä»¶ç›‘å¬ã€DOMæ›´æ–°
      2. VueæŒ‡ä»¤ä¸»è¦ç›®çš„å°±æ˜¯**åŸç”ŸDOMæ“ä½œ**
   2. **å‡å°‘é‡å¤**
      1. å¦‚æœæŸä¸ªDOMæ“ä½œä½ ç»å¸¸ä½¿ç”¨ï¼Œå°±å¯ä»¥å°è£…ä¸ºæŒ‡ä»¤
      2. å¦‚æœæŸä¸ªDOMæ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œä¹Ÿå¯ä»¥å°è£…ä¸ºæŒ‡ä»¤

## â˜…Mixinï¼ˆæ··å…¥å±æ€§ï¼Œæ··å…¥å°±æ˜¯å¤åˆ¶ï¼‰

### <mark>1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦ Mixinï¼Ÿ</mark>

åœ¨å¼€å‘ä¸€ä¸ª**å……æ»¡ç»„ä»¶çš„**åº”ç”¨ç¨‹åºæ—¶ï¼Œé€šå¸¸ä¼šé‡åˆ°ä¸¤ä¸ªéƒ½æœ‰ç€éå¸¸**ç›¸ä¼¼åŠŸèƒ½**çš„ç»„ä»¶ã€‚

é‚£ä¹ˆï¼Œé—®é¢˜æ¥äº†ï¼š

1. æˆ‘ä»¬æ˜¯å¦å¯ä»¥æŠŠè¿™ä¸¤ä¸ªç»„ä»¶åˆäºŒä¸ºä¸€ï¼Ÿ
2. æˆ–è€…ï¼Œä¾æ—§åˆ†å¼€å®ƒä»¬ï¼Œæ¯•ç«Ÿå®ƒä»¬ä¹‹é—´éƒ½æœ‰è¶³å¤Ÿå¤šçš„å·®å¼‚ï¼Œä¸ç„¶ï¼ŒæŠŠå®ƒä»¬ç»“åˆèµ·æ¥çš„è¯ï¼Œä¼šå¯¼è‡´æ›´å¤šçš„é—®é¢˜ï¼ˆç›¸è¾ƒäºä¿©ç»„ä»¶æ²¡åˆå¹¶å‰çš„é—®é¢˜ï¼‰

å¹¸è¿çš„æ˜¯ï¼ŒVue ç»™äº†æˆ‘ä»¬ç¬¬ä¸‰ä¸ªé€‰æ‹©ï¼š**Mixins**

Mixins æ˜¯å°è£…**ä¸€å°éƒ¨åˆ†åŠŸèƒ½**çš„ä¸€ä¸ªæœ‰æ•ˆæ–¹æ³•ï¼Œè€Œè¿™äº›åŠŸèƒ½å¯ä»¥åœ¨å¤šä¸ªç»„ä»¶ä¹‹é—´**é‡ç”¨**ã€‚

æˆ‘ä»¬è¦å­¦çš„ï¼š

1. å¦‚ä½•æä¸ª Mixins å‡ºæ¥ï¼Ÿ
2. å¦‚ä½•**æœ‰æ•ˆåˆ©ç”¨**è¿™ä¸ªæ–¹ä¾¿çš„ Mixins å·¥å…·ï¼Ÿ

### <mark>2ï¼‰åˆ›å»ºä¸€ä¸ª Mixinï¼ˆOption Mergingï¼‰</mark>

* ä¸€ä¸ª mixin å¯¹è±¡æœ‰ï¼šä»»æ„çš„ç»„ä»¶é€‰é¡¹
* å½“ `xx` ç»„ä»¶ä½¿ç”¨ mixin å¯¹è±¡æ—¶ï¼Œæ‰€æœ‰ mixin çš„é€‰é¡¹éƒ½å°†è¢«ã€Œæ··åˆã€è¿›å…¥è¯¥ `xx` ç»„ä»¶çš„æœ¬èº«çš„é€‰é¡¹ä¸­å»ï¼ -> æ°´ï¼ˆç»„ä»¶ï¼‰æ··å…¥äº†ç™½ç³–ï¼ˆmixin å¯¹è±¡ï¼‰
* ç»„ä»¶ å’Œ mixin å¯¹è±¡å«æœ‰åŒåé€‰é¡¹æ—¶ï¼Œ**ä¸åŒåˆ™ä¸€èµ·ç”Ÿæ´»ï¼Œå†²çªï¼ˆå³ç›¸åŒï¼‰åˆ™ç»„ä»¶ä¼˜å…ˆ**
  + `data` æ——ä¸‹çš„ä¹Ÿä¼šé€šè¿‡**é€’å½’å§¿åŠ¿**è¿›è¡Œåˆå¹¶
  + åŒåé’©å­å‡½æ•°å°†åˆå¹¶ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå› æ­¤éƒ½å°†è¢«è°ƒç”¨ï¼Œæ³¨æ„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ¥è‡ª mixin å¯¹è±¡çš„é’©å­ï¼Œ**mixin å¯¹è±¡çš„é’©å­çš„è°ƒç”¨ä¼˜å…ˆäºç»„ä»¶çš„é’©å­**
  + å€¼ä¸º**å¯¹è±¡**çš„é€‰é¡¹ï¼Œå¦‚ `methods` ã€ `components` ã€ `directives` ï¼Œå°†è¢«åˆå¹¶ä¸ºåŒä¸€ä¸ªå¯¹è±¡ã€‚ä¸¤ä¸ªå¯¹è±¡é”®åå†²çªæ—¶ï¼Œ**ä¼˜å…ˆé€‰ç»„ä»¶å¯¹è±¡çš„é”®å€¼å¯¹**ã€‚
  + `Vue.extend()` ä¹Ÿä½¿ç”¨åŒæ ·çš„ç­–ç•¥è¿›è¡Œåˆå¹¶

ç¤ºä¾‹ï¼š

``` js
var mixin = {
  data: function() {
    return {
      message: 'hello',
      mix: 'abc'
    }
  },
  created: function() {
    console.log('æ··å…¥å¯¹è±¡çš„é’©å­è¢«è°ƒç”¨')
  },
  methods: {
    foo: function() {
      console.log('foo')
    },
    conflicting: function() {
      console.log('from mixin')
    }
  }
}

var vm = new Vue({
  el: '#app',
  mixins: [mixin],
  data: function() {
    return {
      message: 'goodbye',
      com: 'def'
    }
  },
  created: function() {
    console.log('ç»„ä»¶é’©å­è¢«è°ƒç”¨')
  },
  methods: {
    bar: function() {
      console.log('bar')
    },
    conflicting: function() {
      console.log('from self')
    }
  }
})
```

æ•ˆæœï¼š

![å†²çªäº†ï¼Œæ€ä¹ˆè¯´](assets/img/2020-07-18-16-05-52.png)

å†ä¸¾ä¸€ä¸ªç¤ºä¾‹ï¼š

``` html
<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta charset="utf-8">
  <title>index7</title>
  <style>
    .red {
      width: 100px;
      height: 100px;
      border: 3px solid lightcoral;
    }

    .green {
      width: 100px;
      height: 100px;
      border: 3px solid lightgreen;
    }
  </style>
</head>

<body>
  <div id="app">
    <div>
      <button @click="Child1isShow=false">child1æ¶ˆå¤±</button>
      <child1 v-if="Child1isShow"></child1>
    </div>
    <br />
    <div>
      <button @click="Child2isShow=false">child2æ¶ˆå¤±</button>
      <child2 v-if="Child2isShow"></child2>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script>
    const log = {
      data() {
        return {
          name: undefined,
          time: undefined
        };
      },
      created() {
        if (!this.name) {
          throw new Error("need Name")
        }
        this.time = new Date();
        console.log(`${this.name}å‡ºç”Ÿäº†`)
      },
      beforeDestroy() {
        const now = new Date() - this.time;
        console.log(`${this.name}æ­»äº¡äº†ï¼Œå…±å­˜æ´»äº† ${now} ms`);
      }
    }

    Vue.component('child1', {
      data() {
        return {
          name: 'child1'
        }
      },
      template: `
      <div class="red">Child1æ¶ˆå¤±</div>
      `,
      mixins: [log]
    })
    Vue.component('child2', {
      data() {
        return {
          name: 'child2'
        }
      },
      template: `
     <div class="green">Child2æ¶ˆå¤±</div>
      `,
      mixins: [log]
    })

    new Vue({
      el: '#app',
      data() {
        return {
          Child1isShow: true,
          Child2isShow: true,
        };
      },
    })
  </script>
</body>

</html>
```

> æˆ‘æŠŠ`mixin`å†™åœ¨åŒä¸€ä¸ªæ–‡ä»¶äº†ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ª`mixins`ç›®å½•ï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`log.js` -> `mixins/log.js`

æ•ˆæœï¼š

![mixin](assets/img/2020-07-18-18-05-50.png)

### <mark>3ï¼‰å…¨å±€æ··å…¥ï¼ˆGlobal Mixinï¼‰</mark>

* ä½¿ç”¨åœºæ™¯å¾ˆå°‘ï¼Œ**å»ºè®®ä¸è¦ä½¿ç”¨**ï¼Œä¸ç„¶ï¼Œä½ çœŸè¿™ä¹ˆåšäº†çš„è¯ï¼Œé‚£ä¹ˆæ¯ä¸ªå•ç‹¬åˆ›å»ºçš„ Vue å®ä¾‹ éƒ½è¢«æ··å…¥äº†ï¼ˆ**åŒ…æ‹¬ç¬¬ä¸‰æ–¹ç»„ä»¶**ï¼‰ -> æœ‰äº›å®ä¾‹å–å’–å•¡çœŸå¾—ä¸éœ€è¦åŠ ç³–å‘€ï¼
* å½“ç„¶ï¼Œæ—¢ç„¶å®ƒå‡ºç°äº†ï¼Œé‚£ä¹ˆè‚¯å®šå°±æœ‰å®ƒçš„ç”¨æ­¦ä¹‹åœ°ï¼ -> **è‡ªå®šä¹‰é€‰ï¼ˆæ³¨å…¥å¤„ç†é€»è¾‘ï¼‰**

ç¤ºä¾‹ï¼š

![å…¨å±€æ··å…¥ç¤ºä¾‹](assets/img/2020-07-18-16-27-26.png)

è™½ç„¶ï¼Œå…¨å±€ mixins å¯ç”¨äºè‡ªå®šä¹‰é€‰é¡¹ï¼Œç„¶åæœ€ä¸€äº›ä¸‡é‡‘æ²¹çš„äº‹å„¿ï¼Œä½†æœ€å¥½è¿˜æ˜¯ä½¿ç”¨æ’ä»¶æ¥æï¼š[æ’ä»¶ â€” Vue.js](https://cn.vuejs.org/v2/guide/plugins.html)

> æ’ä»¶é€šå¸¸ç”¨æ¥ä¸º Vue æ·»åŠ å…¨å±€åŠŸèƒ½

### <mark>4ï¼‰å°ç»“</mark>

1. Mixins -> åœ¨ç»„ä»¶ä¹‹é—´**é‡ç”¨ä»£ç ä»¥å…±äº«è¡Œä¸º**çš„ä¸€ç§ä¾¿æ·æ–¹æ³•ï¼ -> è®©æˆ‘ä»¬çš„ä»£ç åº“å‡å°‘é‡å¤ã€æ›´åŠ æ¨¡å—åŒ–
2. Mixins çš„åˆå¹¶ç­–ç•¥æ˜¯æ€æ ·çš„ï¼Ÿ
   1. åŒåé’©å­ï¼ŒMixinså…ˆè¡Œ -> åŸç†æ˜¯ï¼Œæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯Mixinsçš„é’©å­
   2. åŒå `data` æ——ä¸‹çš„å±æ€§ -> é€’å½’ä¹‹ï¼Œç»„ä»¶å–è€Œä»£ä¹‹
   3. åŒåé€‰é¡¹æ˜¯å¯¹è±¡å€¼ -> ç»„ä»¶å–è€Œä»£ä¹‹
   4. ä¸åŒåï¼Œä¸€èµ·è¿‡ï¼
3. åˆ†å‘ï¼šï¼ˆåŠ¨ï¼‰ä¸€ä¸ªä¸ªåœ°å‘ç»™ã€‚åˆ†å‘æ…°é—®å“ï¼Œå¦‚åˆ†å‘å¥–å“ï¼Œå¦‚åˆ†å‘é€‰é¡¹ç»™ç»„ä»¶å®ä¾‹ï¼Œå…¨å±€mixinså³ä¸»åŠ¨åˆ†å‘ï¼ˆ**ä¸»åŠ¨ç»™ç»„ä»¶å®ä¾‹ï¼Œä¸ç®¡ä½ è¦ä¸è¦**ï¼‰ï¼Œå±€éƒ¨mixinså³è¢«åŠ¨åˆ†å‘ï¼ˆ**ç»„ä»¶å®ä¾‹æƒ³è¦å°±è¦ï¼Œä¸è¦å°±ä¸è¦**ï¼‰
4. ç±»æ¯”ï¼š
   1. `directives`çš„ä½œç”¨æ˜¯å‡å°‘DOMæ“ä½œçš„é‡å¤
   2. `mixins`çš„ä½œç”¨æ˜¯å‡å°‘`data`ã€`methods`ã€é’©å­çš„é‡å¤

## â˜…Extends ç»§æ‰¿ã€æ‰©å±•ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰

### <mark>1ï¼‰æ¦‚è¿°</mark>

è¿™ä¸ªä¸œè¥¿çš„å­˜åœ¨ï¼Œæœ‰ç€ä¸`mixins`åŒæ ·çš„éœ€æ±‚

è¯è¯´ï¼š

- ä¸æƒ³è¦æ¯æ¬¡éƒ½å†™ä¸€ä¸ª `mixins`ï¼Œå’‹åŠå‘¢ï¼Ÿ

ä½ å¯ä»¥ä½¿ç”¨ `Vue.extend` æˆ– `options.extends`

åšæ³•ï¼ŒåŒ`mixins`ç±»ä¼¼ï¼Œé€šè¿‡æš´éœ²ä¸€ä¸ª`extends`å¯¹è±¡åˆ°ç»„ä»¶ä¸­ä½¿ç”¨

ç¤ºä¾‹ï¼š

``` js
// MyVueæ˜¯ä¸€ä¸ªç»„ä»¶å®ä¾‹å“ˆï¼
const MyVue = Vue.extend({
  // or mixins: [log]
  data() {
    return {
      name: '',
      time: undefined
    }
  },
  created() {
    if (!this.name) { console.error('no name!') }
    this.time = new Date();
    console.log(`${this.name}å‡ºç”Ÿäº†`)
  },
  beforeDestroy() {
    const duration = (new Date()) - this.time
    console.log(`${this.name}å­˜æ´»æ—¶é—´${duration}ms`)
  }
})
Vue.component('child1', {
  data() {
    return {
      name: 'child1'
    }
  },
  template: `
  <div class="red">Child1æ¶ˆå¤±</div>
  `,
  extends: MyVue
})
Vue.component('child2', {
  data() {
    return {
      name: 'child2'
    }
  },
  template: `
  <div class="green">Child2æ¶ˆå¤±</div>
  `,
  extends: MyVue
})

new Vue({
  el: '#app',
  data() {
    return {
      Child1isShow: true,
      Child2isShow: true,
    };
  },
})
```

æ•ˆæœæ˜¯ä¸€æ ·çš„â€¦â€¦

è®²çœŸï¼Œæˆ‘å®Œå…¨getä¸åˆ°`extends`çš„ç‚¹ï¼

### <mark>2ï¼‰å°ç»“</mark>

1. ç”¨æ³•ï¼š`const Component = Vue.extend({â€¦â€¦})` -> `new Component(options)` or `Vue.component('child1', {â€¦â€¦,extends:Component}`
2. `extends`æ˜¯æ¯”`mixins`æ›´æŠ½è±¡ä¸€ç‚¹çš„å°è£…
3. å¦‚æœä½ å«Œå†™äº”æ¬¡ `mixins` éº»çƒ¦ï¼Œå¯ä»¥è€ƒè™‘`extends`ä¸€æ¬¡ï¼ -> **ä¸è¿‡å®é™…å·¥ä½œä¸­ç”¨å¾—å¾ˆå°‘**

## â˜…Provideã€Injectï¼ˆæä¾›å’Œæ³¨å…¥ï¼‰

> æ–‡æ¡£ï¼š[provide / inject](https://cn.vuejs.org/v2/api/#provide-inject)

### <mark>1ï¼‰æ¦‚è¿°</mark>

ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨ç»„ä»¶å¼å¼€å‘ä¸­ï¼Œæœ€å¤§çš„ç—›ç‚¹å°±åœ¨äº**ç»„ä»¶ä¹‹é—´çš„é€šä¿¡**ã€‚åœ¨ Vue ä¸­ï¼ŒVue æä¾›äº†å„ç§å„æ ·çš„ç»„ä»¶é€šä¿¡æ–¹å¼ï¼Œä»åŸºç¡€çš„ `props/$emit` åˆ°ç”¨äºå…„å¼Ÿç»„ä»¶é€šä¿¡çš„ `EventBus`ï¼Œå†åˆ°ç”¨äºå…¨å±€æ•°æ®ç®¡ç†çš„ `Vuex`ã€‚

åœ¨è¿™ä¹ˆå¤šçš„ç»„ä»¶é€šä¿¡æ–¹å¼ä¸­ï¼Œ`provide/inject` æ˜¾å¾—ååˆ†é˜¿å¡æ—ï¼ˆæ¯«æ— å­˜åœ¨æ„Ÿï¼‰ã€‚ä½†æ˜¯ï¼Œå…¶å® `provide/inject` ä¹Ÿæœ‰å®ƒä»¬çš„ç”¨æ­¦ä¹‹åœ°

> `provide` å’Œ `inject` ä¸»è¦åœ¨å¼€å‘**é«˜é˜¶æ’ä»¶/ç»„ä»¶åº“**æ—¶ä½¿ç”¨ã€‚å¹¶ä¸æ¨èç”¨äºæ™®é€šåº”ç”¨ç¨‹åºä»£ç ä¸­ã€‚

### <mark>2ï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</mark>

`provide` å¯ä»¥åœ¨ç¥–å…ˆç»„ä»¶ä¸­**æŒ‡å®š**æˆ‘ä»¬æƒ³è¦æä¾›ç»™åä»£ç»„ä»¶çš„**æ•°æ®æˆ–æ–¹æ³•**ï¼Œè€Œåœ¨**ä»»ä½•**åä»£ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä½¿ç”¨ `inject` æ¥æ¥æ”¶ `provide` æä¾›çš„æ•°æ®æˆ–æ–¹æ³•ã€‚

### <mark>3ï¼‰ç¤ºä¾‹1</mark>

![ç¤ºä¾‹1](assets/img/2020-07-19-00-25-30.png)

è¯è¯´ï¼Œå¦‚ä½•å»æ‰é‚£ä¸ªè­¦å‘Šå‘¢ï¼Ÿ -> ç”¨å¼•ç”¨ç±»å‹å€¼ï¼Œè¯¥å¯¹è±¡çš„å±æ€§å°±å¥½äº†ï¼

### <mark>4ï¼‰ç¤ºä¾‹2</mark>

![ç¤ºä¾‹2](assets/img/2020-07-19-00-34-20.png)

æ ¹ç»„ä»¶æˆä¸ºäº†å…¨å±€çŠ¶æ€çš„å®¹å™¨ -> å¾ˆåƒ React ä¸­çš„ context

### <mark>5ï¼‰ç¤ºä¾‹3</mark>

> æ¢è‚¤

``` html
<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta charset="utf-8">
  <title>index9</title>
  <style>
    .app.theme-lightgreen button {
      background: lightgreen;
      color: white;
    }

    .app.theme-lightgreen {
      color: darkcyan;
    }

    .app.theme-lightcoral button {
      background: lightcoral;
      color: white;
    }

    .app.theme-lightcoral {
      color: darksalmon;
    }

    .app.fontSize-normal {
      font-size: 16px;
    }

    .app button {
      font-size: inherit;
    }

    .app.fontSize-small {
      font-size: 12px;
    }

    .app.fontSize-big {
      font-size: 20px;
    }
  </style>
</head>

<body>
  <div id="xxx" :class="`app theme-${themeName} fontSize-${fontSizeName}`">
    <change-button>æ¢è‚¤</change-button>
    <br>
    <button>ğŸŸ¡</button>
    <button>ğŸŸ¡</button>
    <button>ğŸŸ¡</button>
    <button>ğŸŸ¡</button>
    <button>ğŸŸ¡</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script>
    Vue.component('change-button', {
      data() {
        return {}
      },
      template: `
        <div>
          <button @click="changeTheme">æ¢è‚¤</button>
          <button @click="changeFontSize('big')">å¤§å­—</button>
          <button @click="changeFontSize('small')">å°å­—</button>
          <button @click="changeFontSize('normal')">æ­£å¸¸å­—</button>
        </div>
      `,
      inject: ["themeName", "changeTheme", "changeFontSize"]

    })
    new Vue({
      el: '#xxx',
      provide() {
        return {
          themeName: this.themeName,
          fontSizeName: this.fontSizeName,
          changeTheme: this.changeTheme,
          changeFontSize: this.changeFontSize
        }
      },
      data() {
        return {
          themeName: 'lightcoral', // 'lightgreen'
          fontSizeName: 'normal' // 'big' or 'small'
        }
      },
      methods: {
        changeTheme() {
          if (this.themeName === 'lightcoral') {
            this.themeName = 'lightgreen'
          } else {
            this.themeName = 'lightcoral'
          }
        },
        changeFontSize(size) {
          if (["normal", "big", "small"].indexOf(size) === -1) {
            throw new Error(`no size: ${size}`)
          }
          this.fontSizeName = size
        }
      }
    })


  </script>
</body>

</html>
```

æ•ˆæœï¼š

![æ•ˆæœ](assets/img/2020-07-19-00-54-17.png)


### <mark>6ï¼‰å°ç»“</mark>

1. æ…ç”¨ `provide/inject` -> Vue å®˜æ–¹æ¨èä½¿ç”¨ Vuexï¼Œè€Œä¸æ˜¯åŸç”Ÿçš„ API
2. Vuex å’Œ provide/inject æœ€å¤§çš„åŒºåˆ«åœ¨äº:
   1. Vuex ä¸­çš„å…¨å±€çŠ¶æ€çš„æ¯æ¬¡ä¿®æ”¹æ˜¯**å¯ä»¥è¿½è¸ªå›æº¯**çš„
   2. provide/inject ä¸­å˜é‡çš„ä¿®æ”¹æ˜¯æ— æ³•æ§åˆ¶çš„ï¼Œæ¢å¥è¯è¯´ï¼Œä½ **ä¸çŸ¥é“æ˜¯å“ªä¸ªç»„ä»¶ä¿®æ”¹äº†è¿™ä¸ªå…¨å±€çŠ¶æ€**
3. Vue çš„è®¾è®¡ç†å¿µå€Ÿé‰´äº† React ä¸­çš„**å•å‘æ•°æ®æµåŸåˆ™**ï¼ˆè™½ç„¶æœ‰ `sync` è¿™ç§ç ´åå•å‘æ•°æ®æµçš„å®¶ä¼™ï¼‰ï¼Œè€Œ provide/inject **æ˜æ˜¾ç ´å**äº†å•å‘æ•°æ®æµåŸåˆ™ã€‚è¯•æƒ³ï¼Œå¦‚æœæœ‰å¤šä¸ªåä»£ç»„ä»¶åŒæ—¶ä¾èµ–äºä¸€ä¸ªç¥–å…ˆç»„ä»¶æä¾›çš„çŠ¶æ€ï¼Œé‚£ä¹ˆ**åªè¦æœ‰ä¸€ä¸ªç»„ä»¶ä¿®æ”¹äº†è¯¥çŠ¶æ€ï¼Œé‚£ä¹ˆæ‰€æœ‰ç»„ä»¶éƒ½ä¼šå—åˆ°å½±å“**ã€‚è¿™ä¸€æ–¹é¢**å¢åŠ äº†è€¦åˆåº¦**ï¼Œå¦ä¸€æ–¹é¢ï¼Œä½¿å¾—**æ•°æ®å˜åŒ–ä¸å¯æ§**ã€‚å¦‚æœåœ¨å¤šäººåä½œå¼€å‘ä¸­ï¼Œè¿™å°†æˆä¸ºä¸€ä¸ªå™©æ¢¦ã€‚
4. ä¸¤æ¡æ¡ä½¿ç”¨ `provide/inject` åšå…¨å±€çŠ¶æ€ç®¡ç†çš„åŸåˆ™ï¼š
   1. å¤šäººåä½œæ—¶ï¼Œåšå¥½ä½œç”¨åŸŸéš”ç¦»
   2. å°½é‡ä½¿ç”¨ä¸€æ¬¡æ€§æ•°æ®ä½œä¸ºå…¨å±€çŠ¶æ€ï¼Œå³ä¸ä¼šäºŒæ¬¡æ›´æ”¹çš„æ•°æ®ï¼

## â˜…äº†è§£æ›´å¤š

â¹ï¼š[Custom Directives â€” Vue.js](https://vuejs.org/v2/guide/custom-directive.html#Hook-Functions)

â¹ï¼š[Vue: è‡ªå®šä¹‰æŒ‡ä»¤ - ç®€ä¹¦](https://www.jianshu.com/p/06c4f2005ddd)

â¹ï¼š[æ··å…¥ â€” Vue.js](https://cn.vuejs.org/v2/guide/mixins.html)

â¹ï¼š[Mixins - Next-Level Vue - Vue Mastery](https://www.vuemastery.com/courses/next-level-vue/mixins/)

â¹ï¼š[èŠèŠ Vue ä¸­ provide/inject çš„åº”ç”¨ - æ˜é‡‘](https://juejin.im/post/5dc4cbeff265da4d1f51c7f1)

â¹ï¼š[43.Vueå…¨è§£è¿›é˜¶å±æ€§(Directiveã€Mixinã€Extendsã€Provideã€Inject) - æ˜é‡‘](https://juejin.im/post/5ea2978a51882573ae040298)

â¹ï¼š[Vueå…¨è§£ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/149649488)

â¹ï¼š[vue2ç»„ä»¶ä¹‹é—´åŒå‘æ•°æ®ç»‘å®šé—®é¢˜ - å‰ç«¯ç¬”è®° - SegmentFault æ€å¦](https://segmentfault.com/a/1190000011783590)

## â˜…æ€»ç»“

- å¯¹ Vue çš„å­¦ä¹  -> äºŒå…«åŸåˆ™ -> å¸¸ç”¨çš„ 20% API å°±èƒ½è§£å†³å¤§éƒ¨åˆ†æ—¥å¸¸é—®é¢˜ï¼Œå‰©ä½™çš„ç”¨å¤„ä¸å¤§ -> ä½†æ˜¯ï¼ŒæŠ½ç‚¹æ—¶é—´å»äº†è§£é‚£äº›å†·é—¨çš„ APIï¼Œä¹Ÿè®¸ä½ èƒ½å‘ç°ä¸€äº›ä¸ä¸€èˆ¬çš„é£æ™¯ï¼Œä»¤ä½ åœ¨è§£å†³ä¸€äº›é—®é¢˜æ—¶ï¼Œäº‹åŠåŠŸå€ã€‚





