| âœï¸ Tangxt | â³ 2020-07-30 | ğŸ·ï¸ vuex |

# 12-çŠ¶æ€ç®¡ç†ä¸ Vuex

## â˜…æ¦‚è¿°

1. çŠ¶æ€æ˜¯ä»€ä¹ˆ
2. çŠ¶æ€ç®¡ç†æ˜¯ä»€ä¹ˆ
3. Vuex ç”¨æ³•

> è®²çŠ¶æ€ç®¡ç†çš„åŸç†ä»¥åŠæœ€å¸¸ç”¨çš„çŠ¶æ€ç®¡ç† vuex çš„ä½¿ç”¨ï¼

## â˜…çŠ¶æ€ç®¡ç†æ˜¯å•¥ï¼Ÿ

> äº†è§£ã€ŒçŠ¶æ€ç®¡ç†ã€éœ€è¦æ‹†å¼€æ¥çœ‹ -> ã€Œä»€ä¹ˆæ˜¯çŠ¶æ€ã€+ã€Œä»€ä¹ˆæ˜¯çŠ¶æ€ç®¡ç†ã€

1ï¼‰ä»€ä¹ˆæ˜¯çŠ¶æ€ï¼Ÿ

![image-20200731130013032](assets/img/image-20200731130013032.png)

ä¸¾ä¾‹æ¥è¯´ï¼š

![image-20200731130527080](assets/img/image-20200731130527080.png)

2ï¼‰å¦‚ä½•å¯¹çŠ¶æ€è¿›è¡Œç®¡ç†ï¼Ÿ

æˆ‘ä»¬å†™ä¸€ä¸ªç»„ä»¶æ˜¯è¿™æ ·çš„ï¼š

![image-20200731131030607](assets/img/image-20200731131030607.png)

æˆ‘ä»¬å†™ä¸€ä¸ªçˆ¶å­ç»„ä»¶æ˜¯è¿™æ ·çš„ï¼š

![image-20200731131350759](assets/img/image-20200731131350759.png)

**çˆ¶å­ä¹‹é—´æ˜¯å¦‚ä½•é€šä¿¡çš„ï¼Ÿ**

![image-20200731132422615](assets/img/image-20200731132422615.png)

ç„¶è€Œè¿™ç§é€šä¿¡æ–¹å¼ã€Œ**è€¦åˆ**ã€äº†ï¼ˆè®¾è®¡çš„ä¸œè¥¿æœ‰ä¾èµ–ï¼‰ï¼  -> ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ -> å¦‚æœæˆ‘ä»¬ä¸ç”¨ `g-button` ï¼Œç”¨çš„æ˜¯ `el-button` ï¼Œé‚£ä¹ˆä½ èƒ½ä¿è¯ `el-button` é‡Œè¾¹æ˜¯å¦æœ‰å…ƒç´ è¢«ç»‘å®šäº† `click` äº‹ä»¶å‘¢ï¼Ÿå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†™çš„ `@hi` å°±æ˜¯ä¸ªç¬‘è¯ï¼ -> å¯¹äº React æ¥è¯´ï¼Œä¼šç»å¸¸æ€§åœ°ä¼ ä¸ª `onClick` å‚æ•°ï¼

é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•è§£è€¦å‘¢ï¼Ÿï¼ˆ**è§£å†³è€¦åˆçš„é—®é¢˜å°±å«åšè§£è€¦**ï¼‰

**çˆ·çˆ¶å­™é€šä¿¡ï¼Ÿ**

![image-20200731155519294](assets/img/image-20200731155519294.png)

> æˆ‘ä»¬ `@click` å®é™…ä¸Šå°±æ˜¯åœ¨ `this.$on('click',callback)`
ä¸ºå•¥éœ€è¦ `eventBus` ï¼Ÿ

å› ä¸ºå®ƒæ˜¯ä¸ª `new Vue()` ï¼Œ `$on` å’Œ `$emit` è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œæœ‰äº†å®ƒä¹‹åï¼Œç»„ä»¶ä¹‹é—´æ¶ˆæ¯çš„ä¼ é€’å°±ä¸ç”¨é‚£ä¹ˆæ‰‹é€’æ‰‹é‡å¤è¿™æ ·éº»çƒ¦äº†â€¦â€¦

![image-20200731160647120](assets/img/image-20200731160647120.png)

è¯åˆè¯´å›æ¥ï¼Œæˆ‘ä»¬çš„çŠ¶æ€ `n` åªåœ¨ `grandfather` ä¸Šï¼Œå¯å‡å¦‚å…¶å…„å¼Ÿä¸Šä¹Ÿè¦ä¸€ä¸ª `n` å‘¢ï¼Ÿ

> é‚£å°±æŠŠ `n` çŠ¶æ€çš„å­˜æ”¾ä½ç½®æŠ¬é«˜ä¸€çº§å‘—ï¼ -> è®© `n` æ°¸è¿œç«™åœ¨é£Ÿç‰©é“¾çš„é¡¶ç«¯

![image-20200731162524383](assets/img/image-20200731162524383.png)

å•å‘æ•°æ®æµå°±æ˜¯è‡ªä¸Šè€Œä¸‹æµåŠ¨æ•°æ®ï¼Œå¯¹äº Vueã€React æ¥è¯´ï¼Œé¡¶çº§ `n` å˜äº†ï¼Œæ¬¡çº§ä¾èµ–çš„ `n` ä¹Ÿä¼šéšç€å‘ç”Ÿå“åº”å¼çš„å˜æ›´ï¼Œè€Œå…¶å®ƒæ¡†æ¶å¯èƒ½éœ€è¦æ‰‹åŠ¨åšä¸€äº›å¤„ç†ï¼

ç„¶è€Œï¼Œå•å‘æ•°æ®æµä¹Ÿæ˜¯æœ‰ç¼ºç‚¹çš„

> æˆ‘ä»¬çŸ¥é“äº‹ä»¶æ²Ÿé€š `emit('click')` åªéœ€è¦ä¸€æ¬¡ï¼Œäº‹ä»¶ç›‘å¬ `on('click')` ä¹Ÿåªéœ€è¦ä¸€æ¬¡ï¼Œä½†æ˜¯æ•°æ®çš„å•å‘æ•°æ®æµä¼ é€’å¤„å¤„éƒ½éœ€è¦å†™ä»£ç ï¼Œå³æœ‰å‡ ä¸ªç»„ä»¶ç”¨åˆ° `n` ï¼Œé‚£ä¹ˆä½ å°±å¾—ä¼ å‡ æ¬¡ `n`

![image-20200731163832131](assets/img/image-20200731163832131.png)

è¿˜æœ‰å‡å¦‚ï¼Œå¦‚åªæœ‰ä¸€å¤„åœ°æ–¹ç”¨åˆ° `n` å‘¢ï¼Ÿ

![image-20200731164556683](assets/img/image-20200731164556683.png)

æ¸…ç©ºè‡ªå·±ä¹‹å‰çš„è®¤è¯†

æˆ‘ä»¬çŸ¥é“äº‹ä»¶ä¼ é€’å¯ä»¥é€šè¿‡ `eventHub` æ¥æï¼Œè¿™æ ·ä¸€æ¡çº¿ä¸Šå³ä¾¿å­˜åœ¨å‡ ç™¾ä¸ªèŠ‚ç‚¹ï¼Œæ²Ÿé€šèµ·æ¥ä¹ŸæŒºæ–¹ä¾¿çš„ï¼

![image-20200731165329174](assets/img/image-20200731165329174.png)

é‚£ä¹ˆæ˜¯å¦æœ‰ `dataHub` å‘¢ï¼Ÿ

ç›®å‰æˆ‘ä»¬çš„äº‹ä»¶ä¼ é€’å˜è¿æ˜¯è¿™æ ·çš„ï¼š

![image-20200731170012278](assets/img/image-20200731170012278.png)

åŒç†ï¼Œæˆ‘ä»¬å¯¹ `n` ä¹Ÿæ¥ä¸€æ¬¡ `Hub` çš„æ“ä½œï¼š

![image-20200731170500294](assets/img/image-20200731170500294.png)

è¯è¯´ï¼Œ `X` ä»£è¡¨ä»€ä¹ˆå‘¢ï¼Ÿ -> å°±æ˜¯ `Store` å•¦ï¼

æ‰€æœ‰çš„æ•°æ®ç®¡ç†éƒ½ä¼šæœ‰ä¸ª `Store` ï¼Œè€Œ Store å°±æ˜¯å­˜å‚¨ä¸œè¥¿çš„åœ°æ–¹ï¼ä¸€èˆ¬å­˜å‚¨çš„åœ°æ–¹å«åšæŸœå°ï¼Œç”¨æ¥æ”¶é’±ï¼Œè€Œè¿™æ˜¯å•†åº—ï¼Œæ‰€ä»¥ Store åˆæœ‰å•†åº—çš„æ„æ€ï¼

æ‰€ä»¥è¿™å°±æ˜¯ä¸ºå•¥ vuex æœ‰ä¸ªæœ€é‡è¦çš„æ¦‚å¿µâ€”â€”ä½ å¿…é¡»æœ‰ä¸€ä¸ªå…¨å±€çš„ Store

å°±è·Ÿ EventBus ä¸€æ ·ï¼Œä¸ºå•¥ä¸€å®šè¦æœ‰ä¸€ä¸ªå…¨å±€çš„ EventBus å‘¢ï¼Ÿ -> å› ä¸ºç”¨å®ƒæ¥**ä¸“é—¨è´Ÿè´£äº‹ä»¶ç®¡ç†**å‘€ï¼

è€Œ Store åˆ™æ˜¯**ä¸“é—¨è´Ÿè´£æ•°æ®ç®¡ç†**ï¼

ä¸€æ—¦æœ‰äº† Storeï¼Œä½ å°±ä¸ç”¨æ“å¿ƒæ•°æ®çš„è¯»å’Œå†™çš„é—®é¢˜äº†ï¼ -> ä½ ç›´æ¥æŠŠæ•°æ®æ”¾åˆ° Store é‡Œè¾¹å»ï¼Œè¦è¯»æ—¶ï¼Œå°±è°ƒç”¨ Store çš„è¯» APIï¼Œè¦å†™æ—¶ï¼Œå°±è°ƒç”¨ Store çš„å†™ API

ç›®å‰ï¼Œå…³äº Store çš„è¿™ä¸¤ä¸ªè¯»å†™ APIï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“å«å•¥åå­—â€¦â€¦

è¯åˆè¯´å›æ¥ï¼Œä¸ºå•¥æ–¹æ–¹è¦ç¿»è¯‘é‚£ç¯‡ã€Œåœæ­¢å­¦ä¹ æ¡†æ¶ã€å‘¢ï¼Ÿ

å› ä¸ºå¾ˆæœ‰å¯èƒ½è¿™äº›å¤æ‚çš„é—®é¢˜ï¼Œä½ åªéœ€è¦åœ¨å¤§è„‘é‡Œè¾¹æŠŠå®ƒä»¬çš„ç»“æ„ç”»æ¸…æ¥šï¼Œç„¶åå†ç”»å‡ ä¸ªç®­å¤´å°±ææ¸…æ¥šäº†ï¼

è¿™èŠ‚è¯¾è¦å‘Šè¯‰ä½ çš„æ˜¯ï¼š

* æ‰€æœ‰æ¡†æ¶çš„æ ¸å¿ƒéƒ½æ˜¯ä¸€äº›å¾ˆåŸºæœ¬çš„åå­—ï¼Œæ¯”å¦‚è¯´ã€Œäº‹ä»¶ä¼ é€’ã€ã€ã€Œæ•°æ®ä¼ é€’ã€ -> å¦‚æœä½ çš„ç»„ä»¶æ˜¯æ ‘å½¢ç»“æ„çš„ï¼Œä¸ç®¡æ˜¯ Vue ã€React è¿˜æ˜¯ Angularï¼Œéƒ½æ˜¯ä¸€æ ·çš„æ–¹æ³•å¥—è·¯ï¼Œå³æ€»ä¼šæœ‰ä¸ªä¸­ä»‹ä»£ç†ï¼ˆå«å•¥æ— æ‰€è°“ï¼‰ï¼Œåœ¨é‚£ä¸ªç‰¹å®šçš„ä½ç½®æµç€â€¦â€¦

## â˜…è‡ªå·±å…ˆçœ‹ vuex æ–‡æ¡£ä½¿ç”¨ä¸€é

![Vuex](assets/img/2020-08-01-16-11-26.png)

æ–‡æ¡£ï¼š[Vuex æ˜¯ä»€ä¹ˆï¼Ÿ - Vuex](https://vuex.vuejs.org/zh/)

1ï¼‰ç®€å•ä½¿ç”¨

1ã€å®‰è£… vuex

2ã€åˆ›å»ºä¸€ä¸ª store

``` js
Vue.use(Vuex)

const store = new Vuex.Store({
  state: {
    count: 0
  },
  mutations: {
    increment(state) {
      state.count++
    }
  }
})
```

è¯»çŠ¶æ€å¯¹è±¡ï¼š

``` js
store.state.count
```

æ›´æ”¹çŠ¶æ€å¯¹è±¡ï¼š

``` js
store.commit('increment')
```

3ã€åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨

åœ¨ root ç»„ä»¶ï¼ˆ `div#app` ï¼‰ä¸­æ³¨å…¥ `store` ï¼Œè¿™æ · root ç»„ä»¶æ——ä¸‹æ‰€æœ‰çš„å­ç»„ä»¶ã€å­™å­ç»„ä»¶â€¦â€¦éƒ½èƒ½é€šè¿‡ `this.$store` æ¥è®¿é—®äº†

``` js
new Vue({
  el: '#app',
  // store: store
  store
})
```

å­ç»„ä»¶ä¸­ä½¿ç”¨ï¼š

``` js
Vue.component('count', {
  name: 'Count',
  // state
  data() {
    return {

    }
  },
  computed: {
    count() {
      return this.$store.state.count
    }
  },
  // view
  template: `
    <div>{{ count }}<button @click="increment">+1</button></div>
  `,
  // actions
  methods: {
    increment() {
      console.log(this)
      this.$store.commit('increment')
      console.log(this.$store.state.count)
    }
  }
})
```

æ•ˆæœï¼š

![count è®¡æ•°](assets/img/2020-08-01-16-50-13.png)

2ï¼‰å¦‚æœå­ç»„ä»¶éœ€è¦è·å–å¤šä¸ªçŠ¶æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å²‚ä¸æ˜¯éƒ½éœ€è¦æŠŠè¿™äº›çŠ¶æ€éƒ½å£°æ˜ä¸ºè®¡ç®—å±æ€§ï¼Ÿ

> å‡å¦‚æˆ‘è¦è·å– 10 ä¸ªçŠ¶æ€ï¼Œé‚£ä¹ˆå°±å¾—æ 10 ä¸ªè®¡ç®—å±æ€§ -> é‡å¤ã€å†—ä½™

ä½¿ç”¨ `mapState` è¾…åŠ©å‡½æ•°å¸®åŠ©æˆ‘ä»¬ç”Ÿæˆè®¡ç®—å±æ€§

``` js
const mapState = Vuex.mapState

// â€¦â€¦
{
  computed: mapState(['count'])
}
// â€¦â€¦â€¦
```

å¯¹äº†ï¼Œå¦‚æœè¯¥å­ç»„ä»¶è¿˜æœ‰å±€éƒ¨çš„è®¡ç®—å±æ€§å‘¢ï¼Ÿï¼ˆ `mapState` å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼‰

ä¹Ÿå°±è¯´ï¼Œæˆ‘ä»¬è¦æ··åˆä¸€ä¸‹ -> é€šå¸¸ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªå·¥å…·å‡½æ•°å°†å¤šä¸ªå¯¹è±¡åˆå¹¶ä¸ºä¸€ä¸ªï¼Œä»¥ä½¿æˆ‘ä»¬å¯ä»¥å°†æœ€ç»ˆå¯¹è±¡ä¼ ç»™ `computed` å±æ€§ã€‚ä½†æ˜¯è‡ªä»æœ‰äº†å¯¹è±¡å±•å¼€è¿ç®—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥æå¤§åœ°ç®€åŒ–å†™æ³•ï¼š

``` js
{
  computed: {
    test() {
      return 'test'
    },
    // ä½¿ç”¨å¯¹è±¡å±•å¼€è¿ç®—ç¬¦å°†æ­¤å¯¹è±¡æ··å…¥åˆ°å¤–éƒ¨å¯¹è±¡ä¸­
    ...mapState(['count'])
  }
}
```

å¯è§ï¼Œç»„ä»¶ä»ç„¶ä¿æœ‰å±€éƒ¨çŠ¶æ€ -> å¦‚æœæœ‰äº›çŠ¶æ€ä¸¥æ ¼å±äºå•ä¸ªç»„ä»¶ï¼Œæœ€å¥½è¿˜æ˜¯ä½œä¸ºç»„ä»¶çš„å±€éƒ¨çŠ¶æ€ã€‚ä½ åº”è¯¥æ ¹æ®ä½ çš„åº”ç”¨å¼€å‘éœ€è¦è¿›è¡Œ**æƒè¡¡å’Œç¡®å®š**

3ï¼‰Getterï¼ˆ `store` çš„è®¡ç®—å±æ€§ï¼‰

ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ

> éœ€è¦ä» store ä¸­çš„ state ä¸­æ´¾ç”Ÿå‡ºä¸€äº›çŠ¶æ€ -> ä¹Ÿå°±æ˜¯è¯´å¯¹æ‰€æ‹¿åˆ°çš„çŠ¶æ€è¿›è¡ŒäºŒæ¬¡åŠ å·¥ ï¼ŒåŠ å·¥å‡ºæ¥çš„çŠ¶æ€å°±æ˜¯æ´¾ç”Ÿæˆ–è€…è¯´æ˜¯è¡ç”Ÿå‡ºæ¥çš„çŠ¶æ€ -> å¦‚æœåªæœ‰ä¸€ä¸ªç»„ä»¶éœ€è¦è¿™äº›è¡ç”ŸçŠ¶æ€å€’è¿˜å¥½è¯´ï¼Œä½†æ˜¯å‡å¦‚æœ‰å¤šä¸ªç»„ä»¶éœ€è¦è¿™æ ·æå‘¢ï¼Ÿ -> é‚£å²‚ä¸æ˜¯éƒ½éœ€è¦ å¾ˆå¤æ‚çš„ `computed` å¾ˆå¤šæ¬¡ï¼Ÿ

å¦‚å¯¹åˆ—è¡¨è¿‡æ»¤å¹¶è®¡æ•°ï¼š

``` js
{
  computed: {
    doneTodosCount() {
      return this.$store.state.todos.filter(todo => todo.done).length
    }
  }
}
```

åšæ³•ï¼š

1. `getters` ä¸ `state` åŒçº§ï¼Œ `getters` å°±åƒ `computed` ä¸€æ ·ï¼Œ `getter` çš„è¿”å›å€¼ä¼šæ ¹æ®å®ƒçš„**ä¾èµ–è¢«ç¼“å­˜**èµ·æ¥ï¼Œä¸”åªæœ‰å½“å®ƒçš„**ä¾èµ–å€¼å‘ç”Ÿäº†æ”¹å˜**æ‰ä¼šè¢«**é‡æ–°è®¡ç®—**ï¼Œä¸åŒä¹‹å¤„åœ¨äº `getters` å±æ€§éœ€è¦ä¸€ä¸ª `state` å½¢å‚ï¼ˆå¯é€‰ä¸€ä¸ª `getters` å½¢å‚ï¼‰

ç»„ä»¶è®¿é—®ï¼š

1. Getter ä¼šæš´éœ²ä¸º `store.getters` å¯¹è±¡ -> `this.$store.getters.doneTodos`
åŒ `state` ä¸€æ ·ï¼Œä¹Ÿä¼šæœ‰å¯¹ç§°çš„ `mapGetters` è¾…åŠ©å‡½æ•°

> `mapGetters` è¾…åŠ©å‡½æ•°ä»…ä»…æ˜¯å°† `store` ä¸­çš„ `getter` æ˜ å°„åˆ°å±€éƒ¨è®¡ç®—å±æ€§

4ï¼‰Mutationï¼ˆå˜åŒ–ï¼‰

æ›´æ”¹ Vuex çš„ store ä¸­çš„çŠ¶æ€çš„**å”¯ä¸€æ–¹æ³•**æ˜¯æäº¤ mutation -> æäº¤ mutation çš„æ„æ€æ˜¯ï¼Œstore æ——ä¸‹æœ‰ä¸ª `mutations` å±æ€§ï¼Œå…¶ä½œç”¨å°±è·Ÿ `methods` ä¸€æ ·â€¦â€¦

![Mutation](assets/img/2020-08-01-17-32-51.png)

é™¤äº†é»˜è®¤ä¼ ä¸€ä¸ª `state` å‚æ•°ä»¥å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®šé¢å¤–çš„å‚æ•°ï¼Œè€Œè¿™é¢å¤–çš„å‚æ•°å°±æ˜¯ mutation çš„ è½½è·ï¼ˆpayloadï¼‰

![playload](assets/img/2020-08-01-17-38-22.png)

å¯¹äº†ï¼Œæäº¤ mutation çš„å¦ä¸€ç§æ–¹å¼æ˜¯ç›´æ¥ä½¿ç”¨åŒ…å« type å±æ€§çš„å¯¹è±¡ï¼Œå¦‚ï¼š

``` js
store.commit({
  type: 'increment',
  amount: 10
})
```

æ³¨æ„ï¼Œå¦‚æœä½ ç”¨è¿™ç§å§¿åŠ¿ï¼Œé‚£ä¹ˆ**æ•´ä¸ªå¯¹è±¡éƒ½ä½œä¸ºè½½è·**ä¼ ç»™ mutation å‡½æ•°ï¼š

``` js
{
  mutations: {
    increment(state, payload) {
      state.count += payload.amount
    }
  }
}
```

Mutation éœ€éµå®ˆ Vue çš„å“åº”è§„åˆ™ï¼š

> Vuex çš„ store ä¸­çš„çŠ¶æ€æ˜¯å“åº”å¼çš„ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬å˜æ›´çŠ¶æ€æ—¶ï¼Œç›‘è§†çŠ¶æ€çš„ Vue ç»„ä»¶ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°

1. æœ€å¥½æå‰åœ¨ä½ çš„ store ä¸­åˆå§‹åŒ–å¥½æ‰€æœ‰æ‰€éœ€å±æ€§
2. å½“éœ€è¦åœ¨å¯¹è±¡ä¸Šæ·»åŠ æ–°å±æ€§æ—¶ï¼Œä½ åº”è¯¥ï¼š

   1. ä½¿ç”¨ `Vue.set(obj, 'newProp', 123)` or
   2. ä»¥æ–°å¯¹è±¡æ›¿æ¢è€å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œåˆ©ç”¨å¯¹è±¡å±•å¼€è¿ç®—ç¬¦æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š `state.obj = { ...state.obj, newProp: 123 }`
ä½¿ç”¨å¸¸é‡æ›¿ä»£ Mutation äº‹ä»¶ç±»å‹ï¼š

ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ

> ä½¿ç”¨å¸¸é‡æ›¿ä»£ mutation äº‹ä»¶ç±»å‹åœ¨å„**ç§ Flux å®ç°ä¸­æ˜¯å¾ˆå¸¸è§çš„æ¨¡å¼**ã€‚è¿™æ ·å¯ä»¥**ä½¿ linter ä¹‹ç±»çš„å·¥å…·å‘æŒ¥ä½œç”¨**ï¼ŒåŒæ—¶æŠŠè¿™äº›å¸¸é‡æ”¾åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­å¯ä»¥è®©ä½ çš„**ä»£ç åˆä½œè€…å¯¹æ•´ä¸ª app åŒ…å«çš„ mutation ä¸€ç›®äº†ç„¶**

åšæ³•ï¼š

![å¸¸é‡æ›¿ä»£ Mutation äº‹ä»¶ç±»å‹](assets/img/2020-08-01-17-56-20.png)

ç”¨ä¸ç”¨å¸¸é‡å–å†³äºä½ â€”â€”åœ¨**éœ€è¦å¤šäººåä½œçš„å¤§å‹é¡¹ç›®ä¸­ï¼Œè¿™ä¼šå¾ˆæœ‰å¸®åŠ©**ã€‚ä½†å¦‚æœä½ ä¸å–œæ¬¢ï¼Œä½ å®Œå…¨å¯ä»¥ä¸è¿™æ ·åš

Mutation å¿…é¡»æ˜¯åŒæ­¥å‡½æ•°ï¼š

ä¸ºå•¥è¦è¿™æ ·ï¼Ÿ

![åŒæ­¥å‡½æ•°](assets/img/2020-08-01-17-59-46.png)

åƒä¸‡ä¸è¦è¿™æ ·åšï¼š

![ä¸è¦ææˆå¼‚æ­¥å‡½æ•°](assets/img/2020-08-01-18-01-52.png)

![debug å·¥å…·](assets/img/2020-08-01-18-05-51.png)

> å½“ mutation è§¦å‘çš„æ—¶å€™ï¼Œå›è°ƒå‡½æ•°è¿˜æ²¡æœ‰è¢«è°ƒç”¨ï¼Œdevtools ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™å›è°ƒå‡½æ•°å®é™…ä¸Šè¢«è°ƒç”¨â€”â€”å®è´¨ä¸Š**ä»»ä½•åœ¨å›è°ƒå‡½æ•°ä¸­è¿›è¡Œçš„çŠ¶æ€çš„æ”¹å˜éƒ½æ˜¯ä¸å¯è¿½è¸ªçš„**

5ï¼‰Action

Action ç±»ä¼¼äº mutationï¼Œä¸åŒåœ¨äºï¼š

* Action æäº¤çš„æ˜¯ mutationï¼Œè€Œä¸æ˜¯ç›´æ¥å˜æ›´çŠ¶æ€ã€‚
* Action å¯ä»¥åŒ…å«ä»»æ„å¼‚æ­¥æ“ä½œã€‚

ä½¿ç”¨ï¼š

![Action](assets/img/2020-08-01-18-26-26.png)

å‚æ•°è§£æ„ -> ç®€åŒ–ä»£ç ï¼ˆç‰¹åˆ«æ˜¯æˆ‘ä»¬éœ€è¦è°ƒç”¨ commit å¾ˆå¤šæ¬¡çš„æ—¶å€™ï¼‰ï¼š

``` js
{
  actions: {
    increment({
      commit
    }) {
      commit('increment')
    }
  }
}
```

æ‰§è¡Œä¸€ä¸ª Actionï¼š

``` js
store.dispatch('increment')
```

Actions æ”¯æŒåŒæ ·çš„è½½è·æ–¹å¼å’Œå¯¹è±¡æ–¹å¼è¿›è¡Œåˆ†å‘ï¼š

``` js
// ä»¥è½½è·å½¢å¼åˆ†å‘
store.dispatch('incrementAsync', {
  amount: 10
})

// ä»¥å¯¹è±¡å½¢å¼åˆ†å‘
store.dispatch({
  type: 'incrementAsync',
  amount: 10
})
```

> API æ˜¯å¯¹ç§°çš„ï¼
> 
> `promise`ã€`asyncã€await`éƒ½ä¼šä½¿ç”¨åˆ°ï¼

6ï¼‰Module

ç”±äº**ä½¿ç”¨å•ä¸€çŠ¶æ€æ ‘**ï¼Œåº”ç”¨çš„æ‰€æœ‰çŠ¶æ€ä¼šé›†ä¸­åˆ°ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å¯¹è±¡ã€‚å½“åº”ç”¨å˜å¾—éå¸¸å¤æ‚æ—¶ï¼Œ**store å¯¹è±¡å°±æœ‰å¯èƒ½å˜å¾—ç›¸å½“è‡ƒè‚¿**ã€‚

ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼ŒVuex å…è®¸æˆ‘ä»¬**å°† store åˆ†å‰²æˆæ¨¡å—ï¼ˆmoduleï¼‰**ã€‚æ¯ä¸ªæ¨¡å—æ‹¥æœ‰è‡ªå·±çš„ stateã€mutationã€actionã€getterã€ç”šè‡³æ˜¯åµŒå¥—å­æ¨¡å—

7ï¼‰é¡¹ç›®ç»“æ„

Vuex å¹¶ä¸é™åˆ¶ä½ çš„ä»£ç ç»“æ„ã€‚ä½†æ˜¯ï¼Œå®ƒè§„å®šäº†ä¸€äº›éœ€è¦éµå®ˆçš„è§„åˆ™ï¼š

1. åº”ç”¨å±‚çº§çš„çŠ¶æ€åº”è¯¥é›†ä¸­åˆ°å•ä¸ª store å¯¹è±¡ä¸­ã€‚
2. æäº¤ mutation æ˜¯æ›´æ”¹çŠ¶æ€çš„å”¯ä¸€æ–¹æ³•ï¼Œå¹¶ä¸”è¿™ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥çš„ã€‚
3. å¼‚æ­¥é€»è¾‘éƒ½åº”è¯¥å°è£…åˆ° action é‡Œé¢ã€‚

åªè¦ä½ éµå®ˆä»¥ä¸Šè§„åˆ™ï¼Œå¦‚ä½•ç»„ç»‡ä»£ç éšä½ ä¾¿ã€‚å¦‚æœä½ çš„ store æ–‡ä»¶å¤ªå¤§ï¼Œåªéœ€å°† actionã€mutation å’Œ getter åˆ†å‰²åˆ°å•ç‹¬çš„æ–‡ä»¶ã€‚

å¯¹äºå¤§å‹åº”ç”¨ï¼Œæˆ‘ä»¬ä¼šå¸Œæœ›æŠŠ Vuex ç›¸å…³ä»£ç åˆ†å‰²åˆ°æ¨¡å—ä¸­ã€‚ä¸‹é¢æ˜¯é¡¹ç›®ç»“æ„ç¤ºä¾‹ï¼š

```
â”œâ”€â”€ index.html
â”œâ”€â”€ main.js
â”œâ”€â”€ api
â”‚   â””â”€â”€ ... # æŠ½å–å‡º API è¯·æ±‚
â”œâ”€â”€ components
â”‚   â”œâ”€â”€ App.vue
â”‚   â””â”€â”€ ...
â””â”€â”€ store
    â”œâ”€â”€ index.js          # æˆ‘ä»¬ç»„è£…æ¨¡å—å¹¶å¯¼å‡º store çš„åœ°æ–¹
    â”œâ”€â”€ actions.js        # æ ¹çº§åˆ«çš„ action
    â”œâ”€â”€ mutations.js      # æ ¹çº§åˆ«çš„ mutation
    â””â”€â”€ modules
        â”œâ”€â”€ cart.js       # è´­ç‰©è½¦æ¨¡å—
        â””â”€â”€ products.js   # äº§å“æ¨¡å—
```

## â˜…Vuex çš„ store

1ï¼‰å…¶å®ƒ store çš„æ–¹å¼ï¼Ÿ

æ Store çš„è¯ï¼Œç”¨ LocalStorage ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªæ˜¯ç›¸è¾ƒäº Vuex æ¥è¯´ï¼ŒVuex æœ‰æ›´ä¸°å¯Œçš„ API ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼

Vuex å’Œ SessionStorage å­˜å‚¨çš„æ•°æ®æ˜¯ä¸é•¿ä¹…çš„â€¦â€¦

2ï¼‰å¦‚ä½•åˆ©ç”¨ Vue çš„è‡ªåŠ¨æ›´æ–°ï¼Ÿ

> ä¸€ä¸ª A ç»„ä»¶æ›´æ–°äº† Store çš„`n`ï¼Œé‚£ä¹ˆå¦å¤–ä¸€ä¸ª B ç»„ä»¶åŒæ ·ç”¨åˆ°äº†`n`ï¼Œé‚£ä¹ˆè¯¥ B ç»„ä»¶å¦‚ä½•è‡ªåŠ¨æ›´æ–°è¿™ä¸ª `n` å‘¢ï¼Ÿ

![](assets/img/2020-08-01-18-55-03.png)

1. `Vue.use(Vuex)`+æŠŠ`store`åƒ`router`é‚£æ ·æ³¨å…¥åˆ°æ ¹ç»„ä»¶é‡Œè¾¹ -> æ ¹ç»„ä»¶æ——ä¸‹çš„æ¯ä¸ªç»„ä»¶å®ä¾‹éƒ½èƒ½è®¿é—®åˆ°è¿™ä¸ª`store` -> æ¯ä¸ª`store`éƒ½æœ‰äº”å¤§æ ¸å¿ƒå±æ€§ï¼š`state`ã€`getters`ã€`mutations`ã€`actions`ã€`modules`
2. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œé€šè¿‡`computed`è‡ªåŠ¨æ›´æ–°

3ï¼‰EventBus è¿˜æœ‰ç”¨å—ï¼Ÿ

ç›´æ¥ä»ç³»ç»Ÿä¸­å¹²æ‰ï¼

4ï¼‰ä¿¡æ¯ç‚¹

1. é‡‡ç”¨é›†ä¸­å¼å­˜å‚¨ç®¡ç†åº”ç”¨çš„æ‰€æœ‰ç»„ä»¶çš„çŠ¶æ€ -> é‡‡ç”¨ Store æ¥ç®¡ç†
2. mutations -> è¿™ä¸ªæ¦‚å¿µæ–¹æ–¹ä¹‹å‰æ²¡æœ‰æåˆ°ï¼Œæ‰€æœ‰è¿™æ˜¯ vuex è‡ªå·±æå‡ºæ¥çš„ä¸€ä¸ªæ¦‚å¿µ -> æ”¹åŠ¨ -> æŠŠæ‰€æœ‰çš„æ”¹åŠ¨å†™åœ¨è¿™ä¸ª`mutations`é‡Œè¾¹ï¼Œä¸ºå•¥è¦è¿™æ ·å¹²å‘¢ï¼Ÿ -> å› ä¸ºæ–¹ä¾¿ç®¡ç†å‘€ï¼
3. è¯»æ“ä½œï¼ˆ**get**ï¼‰ï¼š`store.state.n` -> å†™æ“ä½œï¼ˆ**set**ï¼‰ï¼š`store.commit('plus')`ï¼ˆéœ€è¦åœ¨`mutations`é‡Œè¾¹å®šä¹‰ä¸€ä¸ªæ“ä½œ`plus`ï¼‰ -> è¿™æ˜¯æ²¡æœ‰ç»“åˆ Vue çš„ä½¿ç”¨ï¼Œè¿™ä¹Ÿæ˜¯ Vuex æä¾›çš„ä¸¤ä¸ª API -> **æ–¹æ–¹å­¦ä¹ æ¡†æ¶åŸºæœ¬ä¸Šå°±æ˜¯æŠŠå·²æœ‰çš„æ¦‚å¿µå¯¹åº”ä¸Šå»å­¦ï¼Œå¦‚`getter å’Œ setter`å¯¹åº”`store.state.n å’Œ store.commit('plus')`**
4. æ–‡æ¡£å†™å¾—å¾ˆç»†ï¼Œå¾ˆå¥½å­¦ï¼Œå¦‚æœå†™å¾—å¾ˆç²—ï¼Œå¦‚ç›´æ¥å«ä½ çœ‹ä»£ç è¿™æ ·çš„ç¨‹åº¦ï¼Œå°±å¾ˆéš¾å†™å­¦äº†ï¼
5. æ–¹æ–¹å¾ˆä¹…æ²¡ç”¨è¿‡ Vuex äº†ï¼
6. åœ¨åˆ›å»º `store` å®ä¾‹å‰ï¼Œå¿…é¡»å…ˆ call `Vue.use(Vuex)`

5ï¼‰Vue ç»„ä»¶ ç»“åˆ Vuex ä½¿ç”¨

ä¸ºä»€ä¹ˆä¼šç”¨`computed`å±æ€§ï¼Ÿ

å› ä¸ºè¿™æ•°æ®å®é™…ä¸Šä¸åœ¨ç»„ä»¶èº«ä¸Šï¼Œè€Œè¿™æ˜¯ç®—å‡ºæ¥çš„ï¼ -> æ¥è‡ª `store`

æµ‹è¯•ä»£ç çš„æ„æ€ï¼š

![æµ‹è¯•ä»£ç ](assets/img/2020-08-01-19-27-59.png)

ä»£ç é€»è¾‘ï¼š

![ä»£ç å®ç°é€»è¾‘](assets/img/2020-08-01-19-35-10.png)

é—®é¢˜æ¥äº†ï¼Œå¦‚æœèŠ‚ç‚¹å˜å¤šï¼Œå³å…¶å®ƒèŠ‚ç‚¹ä¹Ÿç”¨åˆ°äº† `x`ï¼š

![é‡å¤çš„é—®é¢˜](assets/img/2020-08-01-19-40-13.png)

æˆ‘ä»¬ä¸€å¼€å§‹è¦è§£å†³çš„é—®é¢˜å°±æ˜¯é‡å¤çš„æ“ä½œï¼

è€Œç°åœ¨ä½¿ç”¨ vuex åˆé‡å¤äº†â€¦â€¦

æ‰€ä»¥ä½  vuex æ˜¯å¦ç»™æˆ‘ä»¬å¼€å‘è€…æä¾›äº†ä¾¿åˆ©å‘¢ï¼Ÿ

> Vuex æä¾›äº† `mapState` API -> è¯¥ API è™½ç„¶è¡¨é¢ä¸Šä¹Ÿæ˜¯é‡å¤çš„ï¼Œä½†å‡å°‘äº†æˆ‘ä»¬çš„ä»£ç é‡ -> å°‘æ•²å‡ ä¸‹é”®ç›˜ï¼

## â˜…mapState å’Œ mapMutations

