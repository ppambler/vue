### âœï¸ Tangxt â³ 2020-09-17 ğŸ·ï¸ Vuex

# 11-Vue å…¨å±€æ•°æ®ç®¡ç†ï¼ˆä¸Šï¼‰

## â˜…å‰è¨€

ä¸ŠèŠ‚è¯¾é—ç•™çš„é—®é¢˜ï¼šæ”¹äº†è¿™ä¸ªé¡µé¢çš„æ•°æ®ï¼Œå¦ä¸€ä¸ªé¡µé¢æ²¡æœ‰åŒæ­¥æ›´æ–°è¿™ä¸ªæ•°æ® ï¼ˆ**å„è‡ªä¸ºæ”¿**ï¼‰-> è§£å†³åŠæ³• -> å…¨å±€æ•°æ®ç®¡ç†ï¼

æ–¹æ–¹çš„ä¸€ä¸ªè§‚ç‚¹ï¼ˆäººçš„ä¸»è§‚æƒ³æ³•ï¼Œä¸ä¸€å®šå¯¹ï¼‰ï¼š

![å…¨å±€æ•°æ®ç®¡ç†](assets/img/2020-09-21-18-36-57.png)

å‰ç«¯æŠŠè¿™ä¸ªå…¨å±€æ•°æ®ç®¡ç†æå¾—è¶…çº§å¤æ‚ï¼Œè€Œç›®å‰è¿˜å’©æœ‰æŠŠè¿™ä¸ªä¸œè¥¿å›å½’åˆ°æœ€æœ´ç´ çš„çŠ¶æ€ï¼ -> ä¸ºå•¥å’©æœ‰å›å½’ï¼Ÿ -> å› ä¸ºå‰ç«¯è¿˜å’©æœ‰ææ¸…æ¥šå…¨å±€æ•°æ®ç®¡ç†åˆ°åº•æ˜¯ä»€ä¹ˆï¼

â¹ï¼š[åœ¨ 2016 å¹´å­¦ JavaScript æ˜¯ä¸€ç§ä»€ä¹ˆæ ·çš„ä½“éªŒï¼Ÿ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/22782487)

## â˜…å†æ¬¡å°è£… recordListModel

1ï¼‰æå– data

ä»»ä½•æ“ä½œè¡¨çš„ `data` éƒ½äº¤ç»™`recordListModel`æ¥åš -> ä¹‹åçš„ç»Ÿè®¡é¡µé¢æ‹¿æ•°æ®ä¹Ÿæ–¹ä¾¿ï¼

ä»£ç ï¼š[Demo](https://github.com/ppambler/vue-morney/commit/407511195faeecbb015677ba9df18c79272a47e2)

2ï¼‰å°è£… create

> å«`createItem`æ¯”è¾ƒå¥½å¬ï¼ 

ä»£ç ï¼š[Demo](https://github.com/ppambler/vue-morney/commit/dc88c79e7bbf283201da0dafd46c2c6d613a06f5)

ğŸ’¡ï¼šç¬¬ä¸€æ¬¡ä½¿ç”¨`any`ç±»å‹ï¼Ÿ

æŠŠç»å¸¸ç”¨çš„`clone`æ–¹æ³•å°è£…åˆ°`lib`é‡Œè¾¹çš„`clone.ts`

![any ç±»å‹](assets/img/2020-09-21-19-34-54.png)

å…¶å®ƒæ¨¡å—æ–‡ä»¶ä½¿ç”¨è¿™ä¸ª`clone`æ–¹æ³•ï¼Œç›´æ¥`import`ä¸€ä¸‹å°±å¥½äº†ï¼

3ï¼‰å°ç»“

æŠŠè·å–æ•°æ®ï¼Œæ–°å¢æ•°æ®ï¼Œä¿å­˜æ•°æ®çš„æ“ä½œéƒ½å°è£…åˆ°`recordListModel`é‡Œè¾¹å»äº†ï¼

æ¥ä¸‹æ¥åšä¸€ä¸‹å…¨å±€æ•°æ®ç®¡ç† -> è§£å†³é¡µé¢ä¹‹é—´æ•°æ®ä¸åŒæ­¥çš„é—®é¢˜ï¼

## â˜…ç”¨ window æ¥å®¹çº³æ•°æ®

1ï¼‰é¡µé¢ä¹‹é—´æ•°æ®ä¸åŒæ­¥çš„åŸå› 

![æ•°æ®åŒæ­¥](assets/img/2020-09-23-14-28-38.png)

æˆ‘çš„å·²çŸ¥è®¤è¯†æ˜¯è¿™æ ·çš„ï¼š

`Money.vue`é‡Œè¾¹å¯¼å…¥äº†`tagListModel`ï¼Œ`Labels.vue`é‡Œè¾¹ä¹Ÿå¯¼å…¥äº†`tagListModel` -> è¿™ä¸¤ä¸ª`tagListModel`æ˜¯åŒä¸€ä¸ªåœ°å€ï¼

æˆ‘çš„æµ‹è¯•ï¼š

æŠŠè¿™ä¸¤ä¸ª`tagListModel`å„è‡ªæ‰”åˆ°`window`ä¸Šï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦å…¨ç­‰ï¼Ÿ

ç»è¿‡æµ‹è¯•ï¼Œå®ƒä»¬ç¡®å®æ˜¯å…¨ç­‰çš„ï¼

![tagListModel](assets/img/2020-09-23-15-08-47.png)

æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬åœ¨æ ‡ç­¾é¡µåˆ›å»ºäº†ä¸€ä¸ªæ ‡ç­¾ï¼Œå°±ä¼šå¾€`tagListModel`é‡Œè¾¹è¿½åŠ äº†ä¸€ä¸ªæ ‡ç­¾ï¼Œå¯è®°è´¦é¡µå´æ²¡æœ‰åŒæ­¥æ›´æ–°ï¼Ÿ -> æ‰€ä»¥ï¼Œè¿™æ˜¯æ€ä¹ˆä¸€å›äº‹å‘¢ï¼Ÿ

æˆ‘çŒœæµ‹è¿™æ˜¯ Vue ä¸èƒ½æ£€æµ‹æ•°ç»„é¡¹ä¿®æ”¹çš„åŸå› ï¼

æˆ‘ä»¬çŸ¥é“ `tagListModel.data`çš„æ•°æ®ç»“æ„æ˜¯è¿™æ ·çš„ `[{},{}]`ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºæ ‡ç­¾çš„æ—¶å€™ç”¨äº† `tagListModel.data.push({ id, name: name })`ï¼Œè€Œè¿™ä¸ª`push`æ˜¾ç„¶ä¸æ˜¯ Vue æ›´æ”¹è¿‡çš„ `push` æ–¹æ³•ï¼æ‰€ä»¥è¿™å°±å¯¼è‡´äº†æ•°æ®ä¸åŒæ­¥æ›´æ–°çš„é—®é¢˜ï¼

æˆ‘ç”¨äº†`Vue.set()`æµ‹è¯•ä¸€ä¸‹ï¼Œç»“æœè¿˜æ˜¯å¦‚æ­¤ï¼š

![Vue set ä¹Ÿä¸è¡Œ](assets/img/2020-09-23-15-41-50.png)

---

æŒ‰ç…§è€å¸ˆçš„è§£é‡Š -> æˆ‘ä»¬ä»£ç æ˜¯åœ¨æŠŠåŒä¸€ä¸ª JSON å­—ç¬¦ä¸²åˆ†åˆ«åšæˆäº†å¯¹è±¡ 1 å’Œå¯¹è±¡ 2 -> è§£å†³å§¿åŠ¿æ˜¯ -> å¼„æˆæ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼

![è¿™ä¸¤ä¸ª data æ˜¯ä¸åŒçš„](assets/img/2020-09-23-15-49-37.png)

---

æµ‹è¯•ï¼š

![æµ‹è¯•](assets/img/2020-09-23-15-58-15.png)

![ä¸¤æ¬¡ fetch](assets/img/2020-09-23-16-13-25.png)

å†æ¬¡æµ‹è¯•åœ¨ä¸åŒæ¨¡å—é‡Œè¾¹å¯¼å…¥ç›¸åŒçš„æ¨¡å—ï¼š

![æµ‹è¯•](assets/img/2020-09-23-16-08-45.png)

æˆ‘åœ¨`tagListModel.ts`é‡Œè¾¹ï¼Œå†™äº†è¡Œ `console.log(1)`ï¼Œç„¶åå†ä¸åŒæ–‡ä»¶æ¨¡å—é‡Œè¾¹å„å†™ä¸€æ¬¡`import tagListModel from "@/models/tagListModel";`ï¼Œç»“æœåª`log`ä¸€æ¬¡`1`ï¼

2ï¼‰è§£å†³ bug

æ€è·¯ï¼š

![æ€è·¯](assets/img/2020-09-23-17-10-16.png)

åœ¨ `main.ts` é‡Œè¾¹æä¸ªå…¨å±€å˜é‡ -> å¾€ä¸Šæï¼ˆ`Money.vue` -> `App.vue` -> `main.ts`ï¼‰

ä»£ç ï¼š[Demo](https://github.com/ppambler/vue-morney/commit/d6a71bc5a0d15719a2e4f827748c303649e9a853)

ğŸ’¡ï¼šä½ ç›´æ¥è¿™æ ·å†™ï¼š`window.tagList = tagListModel.fetch();`ä¼šæŠ¥é”™ï¼Ÿ

ä¸ºå•¥`tsc`ä¼šæŠ¥é”™ï¼Ÿ -> å› ä¸º`window`æ ¹æœ¬å°±å’©æœ‰`tagList`å±æ€§ï¼Œæ‰€ä»¥ä½ ä¸èƒ½è¿™æ ·åšï¼

æˆ‘ä»¬å†™ JS å¯ä»¥éšæ„åŠ ï¼Œä½†æ˜¯`tsc`æ˜¯ä¸å…è®¸çš„ï¼

æ‰€ä»¥ï¼Œæˆ‘ä»¬å¾—å£°æ˜ä¸€ä¸‹è¿™ä¸ª`Window`

``` ts
// custom.d.ts
interface Window {
  tagList: Tag[];
}
```

ä¸ºå•¥è¦è¿™æ ·åšï¼Ÿæœ‰ç§è„±è£¤å­æ”¾å±çš„æ„Ÿè§‰â€¦â€¦

å…¶å®è¿™æ˜¯ä¸ºäº†çº¦æŸä½ å†™ä»£ç ï¼Œä¿è¯ä¸ä¼šå†™å‡º`taglsit`è¿™æ ·çš„æ— ç”¨å±æ€§ï¼Œä»¥åŠä¸ä¼šå†™å‡º`'666'`è¿™æ ·çš„æ•°æ®ç±»å‹ -> æ€»ä¹‹ï¼Œä½ è¦è®°ä½ï¼Œ`tsc`å°±æ˜¯åœ¨ç”¨ç±»å‹æ£€æŸ¥ä½ çš„ä»£ç å†™å¾—æœ‰æ²¡æœ‰é”™ï¼

ğŸ’¡ï¼šæ ‡ç­¾å¤šäº†ï¼Œåˆ›å»ºæ ‡ç­¾`button`å°±çœ‹ä¸è§äº†ï¼Ÿ

![åˆ›å»ºæ ‡ç­¾](assets/img/2020-09-23-17-12-49.png)

æˆ‘ç›´æ¥ç”¨ `fixed` å›ºå®šå®šä½åŠ æ°´å¹³å±…ä¸­ï¼

---

ä»¥ä¸Šè¿™ä¸ªæ“ä½œå°±æ˜¯ã€Œå…¨å±€æ•°æ®ç®¡ç†ã€ -> å°±æ˜¯è¿™ä¹ˆç®€å•ï¼ -> ä¹Ÿè®¸ä½ å¬è¯´è¿‡ vuex ï¼Œè§‰å¾—å®ƒå¾ˆå‰å®³ï¼Œä½†å…¶å®å®ƒä¹Ÿå°±é‚£æ ·ï¼

æ¥ä¸‹æ¥ï¼Œå°±æŠŠæˆ‘ä»¬è¿™ä¸ªã€Œå…¨å±€æ•°æ®ç®¡ç†ã€å°è£…å¾—æ›´å‰å®³ä¸€ç‚¹ï¼

## â˜…ç”¨ window æ¥å°è£… API 1

1ï¼‰å¯¹ã€Œå…¨å±€æ•°æ®ã€çš„æ“ä½œ

ä¸èƒ½ç›´æ¥`push`æ•°æ®ï¼Œè€Œæ˜¯é€šè¿‡æŸäº› API æ¥ç®¡ç†è¿™äº›æ•°æ®ï¼ -> å…¨å±€æš´éœ² API

2ï¼‰æœ€å°çŸ¥è¯†åŸåˆ™

![æœ€å°çŸ¥è¯†åŸåˆ™](assets/img/2020-09-24-16-28-57.png)

æˆ‘ä»¬å†™ä»£ç çš„æ—¶å€™ï¼Œå¯¹ä¸€ä¸ªå…¨å±€æ•°æ®çš„æ“ä½œï¼Œç†åº”åªæœ‰ä¸€ç§å§¿åŠ¿å»æ“ä½œï¼

æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°è£…ä¸€ä¸ª`createTag`ï¼š

![å°è£…](assets/img/2020-09-24-16-34-13.png)

å¦‚æœä½¿ç”¨ `Promise` å°è£…çš„è¯ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨ `window.createTag`çš„æ—¶å€™ï¼Œé‚£å°±å¯ä»¥è¿™æ ·äº†ï¼š

``` js
window.createTag(name).then(()=>{}).catch((e)=>{
  console.log(e)
})
```

ä»£ç ï¼š[Demo](https://github.com/ppambler/vue-morney/commit/e74a9a51161451dda98145b7f776937cefa27f8a)

3ï¼‰å°è£…æŸ¥æ‰¾ã€æ›´æ–°ã€åˆ é™¤æ ‡ç­¾æ“ä½œ

æ€è·¯ï¼š

![æ€è·¯](assets/img/2020-09-24-17-42-54.png)

ä»£ç ï¼š[Demo](https://github.com/ppambler/vue-morney/commit/8fab303e42359441bd0337ec10a8b6ca81157e17)

ğŸ’¡ï¼š`window.updateTag = (id: string, name: string) => {}`ï¼Ÿ

å¦‚æœä¼ å¤šä¸ªå±æ€§ï¼Ÿå¦‚ï¼Œè¿˜æœ‰`createdAt`ç­‰è¿™æ ·çš„å±æ€§ï¼Œé‚£ä¹ˆå°±å¾—è¿™æ ·å†™äº†ï¼š

``` ts
type Tag = {
  id: string;
  name: string;
  // â€¦â€¦ 
};
// è¿™æ ·åšå¿…é€‰ä¼  idï¼Œå› ä¸º Tag çš„ç±»å‹å®šä¹‰å¹¶å’©æœ‰å†™ ?
window.updateTag = (id: string, object: Tag) => {}
```

å¦‚æœé™¤äº†`id`éƒ½å¯ä»¥ä¼ å‘¢ï¼Ÿ

é‚£å°±è¿™æ ·å†™ï¼š

``` ts
window.updateTag = (id: string, object: Exclude<Tag, 'id'>) => {}
```

è¡¨ç¤º`Tag`é‡Œè¾¹ï¼Œé™¤äº†`'id'`çš„æ‰€æœ‰ä¸œè¥¿ -> ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä¸èƒ½ä¼ `id`ï¼

ä¸ç®¡æ€æ ·ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œå°±ç›´æ¥`id: string, name: string` è¿™æ ·å®šä¹‰å½¢å‚äº†ï¼

ğŸ’¡ï¼šç±»å‹å£°æ˜ä¸€æ ·ï¼Œèƒ½å¦ç®€å†™ï¼Ÿ

![ç±»å‹ä¸€æ ·](assets/img/2020-09-24-17-34-43.png)

å¯ä»¥ç®€å†™çš„ï¼Œä½ å¯ä»¥è¿™æ ·åšï¼š

``` ts
interface Window {
  updateTag: TagListModel['update']
}
```

è¡¨ç¤º`updateTag`çš„ç±»å‹ï¼Œè·Ÿ`update`çš„ç±»å‹å®Œå…¨ä¸€æ¨¡ä¸€æ ·ï¼

å½“ç„¶ï¼Œæˆ‘ä»¬é‡å¤å†™ä¸¤éä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ï¼æ¯•ç«Ÿå¦‚æœ`TagListModel`æ”¹äº†å°±éº»çƒ¦äº†ï¼

ğŸ’¡ï¼šå˜é‡åªç”¨äº†ä¸€éï¼Œé‚£å°±ç®€åŒ–å®ƒï¼Ÿ

![ç®€åŒ–ï¼Ÿ](assets/img/2020-09-24-17-49-05.png)

``` ts
{
  created() {
    this.tag = window.findTag(this.$route.params.id);
    if (!this.tag) {
      this.$router.replace("/404");
    }
  }
}
```

å˜é‡åªç”¨äº†ä¸€éï¼Œé‚£ä¹ˆå°±ä¸ç”¨åŠ å±€éƒ¨å˜é‡äº†ï¼

ğŸ’¡ï¼šä¸èƒ½åœ¨`data`é‡Œè¾¹æ‹¿åˆ°`id`å—ï¼Ÿ

![ç»†èŠ‚](assets/img/2020-09-24-17-54-49.png)

çŒœæµ‹ï¼ŒVue æ˜¯åœ¨ `created` çš„æ—¶å€™ï¼Œæ‰ä¼šæ„é€ å‡º`this.$route`è¿™ä¸ªå¯¹è±¡ï¼

å½“ç„¶ï¼Œæˆ‘ä»¬åœ¨`beforeCreated`é‡Œè¾¹ï¼Œä¹Ÿæ˜¯å¯ä»¥æ‹¿åˆ°è¿™ä¸ª`id`çš„ï¼

æ€»ä¹‹ï¼Œä½ ä¸èƒ½åœ¨ç»™`data`çš„èµ‹å€¼é‡Œè¾¹ï¼Œé€è¿‡`this.$router`æ‹¿åˆ°`id` -> å› ä¸ºæ­¤æ—¶å¯èƒ½æ²¡æœ‰`$route`å¯¹è±¡ï¼ˆå…·ä½“ç¡®åˆ‡æƒ…å†µï¼Œå¾—åˆ†ææºç ï¼‰ï¼

---

ä»¥å‰æˆ‘ä»¬æ˜¯å¯¹ DOM æ ‘å¢åˆ æ”¹æŸ¥ï¼Œç°åœ¨åˆ™æ˜¯å¯¹æ•°ç»„ï¼ˆ`tagList`ï¼‰å¢åˆ æ”¹æŸ¥ï¼

æ¥ä¸‹æ¥å°è£…å¦å¤–ä¸€ä¸ªä¸œè¥¿ï¼Œç›®å‰ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ•°æ®ï¼ˆæ ‡ç­¾æ•°æ®å’Œè®°è´¦æ•°æ®ï¼‰ï¼Œä¸€ä¸ªæ˜¯`tagList`ï¼ˆå·²å°è£…ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯`recordList` -> ä»¥**ç›¸åŒçš„å½¢å¼**æ¥å°è£…è®°è´¦æ•°æ®ï¼

## â˜…ç”¨ window æ¥å°è£… API 2


